\def\R{\mathbf{R}}
\def\N{\mathbf{N}}
\def\L{\mathbf{L}}
\def\Z{\mathbf{Z}}

\def\bcirc{\mathbin{\mathpalette\makebcirc{\circ}}} 
\def\bast{\mathbin{\mathpalette\makebcirc{\ast}}}
\def\msurr{\mathsurround=0pt}
\def\makebcirc#1#2{% #1 je <style primitive> a #2 \circ nebo \bullet
   \ooalign{$#1\bigcirc\msurr$\cr \hfil$#1#2\msurr$\hfil}}

\def\corr{\bast}
\def\conv{\ast}

\section{Základní pojmy}

Mìjme dánu spojitou funkci $f:L_1^2\rightarrow \R$, tedy $f(x,y)$ integrabilní. Nazveme ji {\em spojitým obrazem}.
Podobnì {\em diskrétní obraz} definujeme jako posloupnost $F_{ij}\in \hat{n}\cup \{0\}$ pro $i,j\in\Z,n\in\N$.
Libovolné zobrazení $\Phi: f(x,y)\rightarrow F_{ij}$ nazýváme {\em digitalizací}.



\ods{Digitalizace}


Digitalizaci rozli¹ujeme podle toho, zda diskretizaci provedeme v prostoru souøadnic èi v oboru hodnot. Pak hovoøíme o
 \begin{itemize}
\item {\em vzorkování (prostor souøadnic)}
\item {\em kvantování (obor hodnot)}
 \end{itemize}

 Ukazuje se, ¾e vzorkování lze za urèitých pøedpokladù provést tak, aby se ¾ádná informace neztratila.
 
\ods{Pøedzpracování} -- sem patøí následující operace:
 
 \begin{itemize}
\item potlaèení ¹umu
\item zvýraznìní hran
\item doostøení
\item zmìna kontrastu
 \end{itemize}

\ods{Analýza} -- je v podstatì získávání dal¹í dodateèné (neobrazové) informace z obrazu. Pøíkladem je tøeba
urèení hranic, rozpoznávání objektù, atd.

\subsection{Matematické transformace}

\ods{Konvoluce}
Definujeme {\em konvoluci} dvou funkcí $f,g$ jako zobrazení $A: \L_1\times\L_1\rightarrow L_2$

\begin{equation}
(f\conv g)(x)=\int f(t)g(x-t)\d t
\end{equation}

V podstatì se tedy jedná o prùmìrování funkce $f$ jinou funkcí $g$, proto¾e $g$ je obyèejnì symetrická funkce s
malým supportem \refobr{konvoluce}. Je-li napø. $g$ obdelníkový puls, pak se jedná o klasické prùmìrování. Dost 
èasto se taky po¾aduje, aby výsledná funkce mìla stejnì omezený obor hodnot jako pùvodní $f$, tak¾e se volí $\int g=1$.

\vecobr{0.6}{konvoluce}{K definici konvoluce v 1D.}
\vecobr{0.6}{konv}{Ukázka konvoluce dvou obdélníkových pulsù. A problém poèítání prvku na okraji pøi diskrétní konvoluci 
ve 2D.}
V diskrétním pøípadì je $F$ i $G$ matice. Otoèenou matici $G$ posouváme po $F$ a do ka¾dého bodu výsledné matice
napí¹eme souèet souèinù pøekrývajících se prvkù. Na krajích matice $F$ a v rozích je pak tøeba zvolit postup, jak se chovat.
Pokud zùstaneme s $G$ uvnitø $F$, výsledná matice bude men¹í ne¾ pùvodní. Vìt¹inou se dìlá stejnì velká matice jako $F$, ale
stejnì tak ji lze i roz¹iøovat \refobr{konv}.

\ods{Korelace}

{\em Korelaci} dvou funkcí definujeme podobnì jako konvoluci s tím rozdílem, ¾e funkce $g$ se \uv{neotáèí}. Je to tedy opìt zobrazení $A: \L_1\times\L_1\rightarrow L_2$

\begin{equation}
(f\corr g)(x)=\int f(t)g(t-x)\d t
\end{equation}

\ods{Spojitá Fourierova transformace (CFT)}
Nech» $f\in L_1$, pak {\em Spojitá Fourierova transformace\footnote{Fourierova transformace a Spojitá Fourierova transformace se
nepatrnì li¹í.\\$FT(f(x))=\int f(x)e^{-i u x}\d x,\quad IFT(F(u))=\frac{1}{2\pi}\int F(u)e^{i u x}\d u$}} je definována vztahem:

\begin{equation}
F(u)=\int f(x)e^{-2\pi i u x}\d x
\end{equation}

Existence komplexní funkce $F$ plyne z pøedpokladu, není ov¹em zaruèeno, ¾e i $F(u)$ bude z $L_1$. 
V podstatì se jedná o vyjádøení pùvodní
funkce jako lineární kombinace $\sin$ a $\cos$ funkcí.

V diskrétním prostoru, nech» máme ortonormální bázi funkcí 
\begin{equation}
\mathcal{B}=\{\sin mx,\cos nx,1\}
\end{equation}
na koneèném
dvojrozmìrném intervalu. Funkci $f$ jsme pak schopni
vyjádøit ve tvaru $f=\sum c_k \phi_k$, kde $c_k$ jsou tzv. {\em Fourierovy koeficienty}. To, ¾e jsme se omezili pouze na
celoèíselné násobky frekvencí má za následek fakt, ¾e jsme schopni v celém oboru popsat jen periodické funkce. V obecném
 pojetí lze libovolnou funkci slo¾it z bazických $\sin$ a $\cos$ funkcí, ov¹em jejich frekvence musí být spojitì se mìnící.
 
\ods{Spojitá Fourierova transformace ve 2D (CFT2)}
\begin{equation}
F(u,v)=\int f(x,y)e^{-2\pi i (ux+vy)}\d x\d y
\end{equation}

\ods{Inverzní spojitá Fourierova transformace (ICFT)}
\begin{equation}
f(x)=\int F(u)e^{2\pi i u x}\d u
\end{equation}

\ods{Inverzní spojitá Fourierova transformace 2D (IFT2)}
\begin{equation}
f(x,y)=\int F(u)e^{2\pi i (u x+vy)}\d u\d v
\end{equation}
 
Ze vztahù a z vlastnosti integrálnu je zøejmé, ¾e 
\begin{eqnarray}
f_1+f_2\stackrel{CFT}{\rightarrow} F_1+F_2\\
\alpha f \stackrel{CFT}{\rightarrow} \alpha F
\end{eqnarray}

\ods{Diracùv puls ($\delta$-funkce)} 

V signálech se definuje speciální bodová funkce $\delta$, která je v¹ude nulová, jen v nule má takovou hodnotu, ¾e
$\int \delta(x)=1$.

\begin{eqnarray}
\delta(x)&=&\left\{\begin{array}{ll}0\quad x\neq0\\.\quad x=0\end{array}\right.\\
\int\limits_{-\infty}^\infty\delta(x)\d x&=&1
\end{eqnarray}

Platí tyto vztahy, jejich¾ dùkaz pøenecháme matematické analýze.

\begin{eqnarray}
f\conv\delta&=&f\quad\forall f\\
FT(\delta)&=&1\\
FT(1)&=&\delta
\end{eqnarray}

\ods{Konvoluèní teorém}  Vyjadøuje skuteènost, ¾e konvoluci lze ve frekvenèní oblasti pøevést na násobení a naopak.

\begin{eqnarray}
FT(f\conv g)&=&F\cdot G\\
FT(f\cdot g)&=&F\conv G
\end{eqnarray}

Zde se symbolem $\cdot$ nemyslí maticové násobení, ale násobení stejnì rozmìrných matic po prvcích.
Pokud chceme ovìøit konvoluèní teorém v praxi, je potøeba diskrétní data periodicky prodlu¾ovat!

Poznamenejme, ¾e pøi FT2, tedy dvojdimenzionální Fourierovì transformaci, dostáváme komplexní data ({\em Fourierùv obraz}).
Proto¾e jsme ov¹em pùvodnì mìli reálný signál, bude fourierùv obraz symetrický podle støedu. Co se týká nároènosti,
má výpoèet FT (1D) v základním tvaru slo¾itost $O(n^2)$. V roce 1965 Cooley a Turkey ukázali urychlení výpoètu za pøedpokladu
$n=2^k$. Tato rychlá Fourierova transformace (FFT) se pou¾ívá dodnes, lze ji sestrojit pro obecné obdélníkové matice
a její slo¾itost je $O(n\log n)$. Naproti tomu konvoluce má slo¾itost $O(n^2)$ pro ka¾dý bod výsledné matice, 
tedy je jasné, ¾e pøi poèítání konvoluce s rozmìrnìj¹ími maticemi je výhodnìj¹í pou¾ít konvoluèního teorému a ve frekvenèní
oblasti pouze vynásobit matice. Napøíklad u¾ pro obrázek $512\times512$ a konvoluèní matici  $11\times11$ je pou¾ití
konvoluèního teorému výhodnìj¹í.

Nyní uka¾me jak vypadá Fourierùv obraz {\em obdélníkového pulsu}. Nech» $f$ je funkce definovaná takto:

\begin{eqnarray}
f(x)&=&\left\{\begin{array}{ll}c\quad\forall x\in\langle-\lambda,\lambda\rangle,c\in \R\\
0\quad\hbox{jinde}\end{array}\right.\\
\noalign{\hbox{pak}\nonumber}\\
F(u)&=&\int\limits_{-\infty}^{\infty}f(x)e^{-2\pi iux}\d x=c\int\limits_{-\lambda}^\lambda e^{-2\pi i u x}\d x=\nonumber\\
&=&\frac{c}{-2\pi i u}\left[e^{-2\pi uix}\right]_{-\lambda}^\lambda=c\frac{e^{-2\pi iu\lambda}-e^{2\pi iu\lambda}}{-2\pi i u}=\nonumber\\
&=&\frac{c}{\pi u}\sin(2\pi\lambda u)\\
\noalign{\hbox{Pro $c=2$ a $\lambda=\frac{1}{2}$ bude\nonumber}}\\
F(u)&=&\frac{\sin(\pi u)}{\pi u}=\mathrm{sinc}(u)
\end{eqnarray}

Pozn. Ve 2D vzniká funkce $\mathrm{sinc}(x)\mathrm{sinc}(y)$. Tato funkce není støedovì symetrická, jak by se mohlo zdát.

\vecobr{0.5}{sinc}{Fourierova transformace obdélníkového pulsu a vzniklá funkce $\mathrm{sinc}(u)$.}

Pøi násobné konvoluci obdélníkových pulsù vznikají køivky, které se oznaèují jako {\em B-spline}. Mimo jiné mají tu
vlastnost, ¾e aproximují Gaussovu funkci normálního provdìpodobnostního rozlo¾ení.

\vecobr{0.5}{bspline}{Opakováním konvoluce obdélníkových pulsù vznikají B-spline køivky, které stále lépe aproximují
Gaussovu rozdìlovací funkci.}

\ods{Fourier Shift Theorem (FST)}  Máme-li funkci $g$ posunutou vzhledem k $f$ o konstantu $a$, dává Fourierova transformace vztah:

\begin{equation}
f(x-a)\stackrel{CFT}{\rightarrow} e^{-2\pi i a u} F(u)
\end{equation}
Proto¾e
\begin{eqnarray}
f(x-a)&=&g(x)\stackrel{CFT}{\rightarrow}\int g(x)e^{-2\pi i u (x-a+a)}\d x=\nonumber\\
&=&\int f(x-a)e^{-2\pi i u (x-a)-2\pi i u a}\d x=\nonumber\\
&=&e^{-2\pi i u a}\int f(x-a)e^{-2\pi i u (x-a)}\d x=\bigg\{\hbox{subst. $y=x-a$}\bigg\}=\nonumber\\
&=&e^{-2\pi i u a}\int f(y)e^{-2\pi i u y}\d y=e^{-2\pi i u a}F(u)
\end{eqnarray}


Tedy obraz je akorát násobený komplexní jednotkou $e^{-2\pi iau}$, jeho amplituda má tedy stejnou velikost jako originál.
Toho lze vyu¾ít pro rozpoznávání, fázi lze zjistit dodateènì. Lze také ukázat, ¾e nejpodstatnìj¹í èást obrazové informace
je obsa¾ena ve fázi, amplituda nemá tak zásadní vliv na vzhled obrazu.

\subsection{Digitalizace}

\begin{equation}
f(x)\rightarrow \{\hbox{vzorkování}\}\rightarrow d(x) \rightarrow \{\hbox{kvantování}\} \rightarrow F\qquad F\in\langle0,255\rangle
\end{equation}

Pøi vzorkování ({\em sampling}) vzniká otázka, jak hustì vzorkovat, abychom neztratili obrazové informace, 
eventuelnì, zda existuje vzorkovací frekvence, která ji¾ zachytí v¹echny tyto informace. Shannonùv teorém dává za urèitých
pøedpokladù kladnou odpovìd na pøedchozí otázku. 

Vzorkování lze pova¾ovat a za násobení pùvodího spojitého signálu nekoneèným polem $\delta$-funkcí.

\begin{eqnarray}
s(x,y)&=&\sum\limits_{i=-\infty}^\infty\sum\limits_{j=-\infty}^\infty\delta(x-i\Delta x,y-j\Delta y)\\
d(x,y)&=&f(x,y)\cdot s(x,y)
\end{eqnarray}

Lze ukázat, ¾e Fourierùv obraz nekoneèného pole $\delta$-funkcí bude opìt nekoneèné pole $\delta$-funkcí s krokem
$\frac{1}{\Delta x},\frac{1}{\Delta y}$. Ve frekvenèní oblasti pak dostáváme
\begin{eqnarray}
S(U,V)&=&\frac{1}{\Delta x}\frac{1}{\Delta y}\sum\limits_{i=-\infty}^\infty\sum\limits_{j=-\infty}^\infty
\delta(\frac{u-i}{\Delta x},\frac{u-j}{\Delta y})\\
D(u,v)&=&F(u,v)\conv S(u,v)\label{shannon}
\end{eqnarray}

Tedy zvy¹ováním vzorkovací frekvence (tj. zmen¹ováním $\Delta x$ a $\Delta y$) souèasnì zvy¹ujeme vzdálenost mezi
Fourierovými obrazy dvou vzorkù, proto¾e funkce $D(u,v)$ ve vztahu (\ref{shannon}) není nic jiného ne¾ opakováním
funkce $F(u,v)$ ve vzálenosti Fourierových pulsù vzorkovací funkce. Pokud budeme chtít funkci zrekonstruhovat
z jejích Fourierových vzorkù je nezbytnì nutné, aby tyto vzorky nebyly po¹kozeny vzájemným pøekrytím. To je mo¾né za 
dvou pøedpokladù

\begin{itemize}
\item Pokud je funkce frekvenènì omezená. U frekvenènì neomezených funkcí, kde neexistuje $f_{\max}<\infty$, je i jejich
frekvenèní spektrum neomezené, proto se vzorky budou pøekrývat v¾dy.
\item Pokud je vzorkovací frekvence vìt¹í nebo rovna dvojnásobku maximální frekvence $f_{\max}$ (tzv. Nyquistùv limit)
\end{itemize}

\vecobr{0.6}{sampling}{Vzorkování ve frekvenèní oblasti a pøekrývání obrazù frekvenènì omezené funkce}
 
Co¾ je zmínìný {\em Shannonùv vzorkovací teorém}. Ideální rekonstrukèní filtr má tedy ve Fourierovì oblasti tvar obyèejné
schodovité funkce a její spojitý vzor v èasové oblasti  má tvar ji¾ zmínìné funkce $\mathrm{sinc}$.
\begin{equation}
\mathrm{sinc}(x,y)=\frac{\sin(\pi x)\sin(\pi y)}{\pi x \pi y}
\end{equation}

Pro frekvenènì neomezené funkce by byl teoreticky potøeba nekoneènì malý krok. Vzorkováním tak vzniká velmi
nepøíjemný jev zvaný {\em Aliasing}.

\ods{Aliasing} vzniká ve dvou pøípadech
\begin{enumerate}
\item Pokud je pùvodní funkce frekvenènì neomezená, tj. neexistuje ¾ádná maximální frekvence a funkci tudí¾ nelze v diskrétním
rastru reprezentovat pøesnì.
\item Funkce je sice frekvenènì omezená, tj. existuje $f_{\max}<\infty$, ale funkci vzorkujeme s frekvencí men¹í ne¾li
$2f_{\max}$, tedy pod Nyquistovým limitem.
\end{enumerate}

\subsection{Kvantování} 

Kvantování je zobrazení z $\R$ do mno¾iny $K=\{0,1,\dots,l-1\}$. Poèet intenzit $l$ se vìt¹inou volí 256.
Z povahy mno¾in $\R$ a $K$ je jasné, ¾e se jedná o ztrátovou operaci a není jenoznaèný inverzní proces. Hodnoty intenzit
$i\in K$ oznaèujeme pøi kvantování jako tzv. {\em Kvantovací prahy}.

Kvantovací prahy mù¾eme volit nìkolika zpùsoby. První a poslední je vìt¹inou urèen snímacím zaøízením. Dále se pou¾ívají
\begin{itemize}
\item {\em ekvidistantní} -- prahy jsou od sebe stejnì vzdáleny, velmi èasto se pou¾ívá
\item {\em logaritmické (exponencielní)} -- vyu¾ívá se u ztmavených obrázkù
\item dal¹í volba je tøeba taková, aby ka¾dá barva byla zastoupena pøibli¾nì stejným poètem pixelù
\end{itemize}

\hyphenation{kvan-ti-zaèní}
\vecobr{0.6}{kvantovani}{Kvantovací prahy a vznik fale¹ných kvantizaèních hran}
Nedostateèným poètem úrovní intenzit  vznikají fale¹né kvantizaèní hrany (false contour effect). Lidské oko se ov¹em
podle hran orientuje, proto se pøidává aditivní ¹um, který tento nepøíjemný efekt rozma¾e (samozøejmì pouze tehdy, pokud 
nelze zvý¹it poèet prahù).

Máme-li omezenou pamì» je tøeba volit vhodnì poèet úrovní a prostorové rozli¹ení.
Má-li obraz málo detailù, je lep¹í volit více hodnot pro kvantování s men¹ím rozli¹ením,
pro hodnì detailù a hran upøednostnit vet¹í rozli¹ení a ménì úrovní pro kvantování.

\ods{Charakteristiky lidského oka} Experimentálnì byly zjistìny tyto charakteristiky  zdravého liského oka.
\medskip

\begin{tabular}{ll}
$\bullet$ prostorová rozli¹ovací schopnost& 0,1~mm ze vzdálenosti 25~cm\\
$\bullet$ rozli¹ení ¹edi (oddìlìnì) & 40 úrovní \\
$\bullet$ rozli¹ení ¹edi (porovnání vedle sebe) & 100 úrovní 
\end{tabular}

\medskip
\noindent Dále podle prùzkumu, bylo vypozorováno, ¾e standartní obrázek velikosti $512\times512$ se 128 stupni ¹edi 
zobrazený na plochu $5\times5$ cm pozorovaný ze vzdálenosti 25~cm se jeví jako {\bf spojitý}.

\section{Pøedzpracování}
\subsection{Operace s Histogramem}

\begin{description}
\item[Histogram] obrazu je funkce èetností jednotlivých intenzit. Lze jej pøirovnat k hustotì pravdìpodobnosti
\item[Kumulativní histogram] je pak funkce intenzit, kde pro ka¾dou intenzitu je funkèní hodnota rovna poètu bodù
 mající svou intenzitu men¹í nebo rovnu. Je to tedy obdoba distribuèní funkce.
\end{description} 

\vecobr{0.6}{histogram}{Histogram a kumulativní histogram}

\ods{Pøedzpracování obrazu}

Patøí sem
\begin{enumerate}
\item Metody pro vylep¹ení vzhledu (Image enhancement methods) -- zmìna jasu a kontrastu, potlaèení ¹umu, zvýraznìní hran
\item Obnovení obrazu (Image restauration) -- sna¾íme se rozpoznat a invertovat vzniklé po¹kození
\end{enumerate}

\subsection{Image enhancement methods} 
\ods{Jas a kontrast}
Zmìna kontrastu a jasu se provádí zmìnou hodnot v histogramu. Realizuje se transformaèní funkcí $\psi:K\rightarrow K$.
Hodnota výsledkù závisí pouze na hodnotì v jednom bodì, jedná se tedy o {\em bodové operace}.

\vecobr{0.6}{zmkontrast}{Zmìna kontrastu v histogramu a znázornìní transformaèní funkce (nahoøe a vlevo dole). Vpravo dole pak transformaèní
funkce pro provedení binarizace obrázku.}

\ods{Ekvalizace histogramu} je operace, kdy chceme pøevést histogram na po¾adovaný tvar (napø. konstatní). K transformaci 
pou¾íváme distribuèní funkci (kumulativní histogram). Dojde-li k tomu, ¾e následující hodnota v histogramu pro 
danou intenzitu pøevy¹uje po¾adovanou hodnotu, je potøeba provést ¹tìpení (tj. nìjakým zpùsobem ji rozdìlit
do více intenzit). Nìkdy se ekvalizuje i lokálnì (zmìna jasu, kontrastu), postup probíhá v oknì podobnì jako pøi konvoluci.

\vecobr{0.6}{ekvhist}{Ekvalizace histogramu -- pøevedení na konstantní histogram.}

\subsection{Odstranìní ¹umu}

\ods{Aditivní model ¹umu}
Pøedpokládejme tzv. {\em aditivní model ¹umu\footnote{Existuje i multiplikativní model ¹umu, tj. $f=f_{\mathrm{org}}\cdot n$.}}, neboli na signálu nezávislý ¹um. Modelujeme jej pomocí funkce $n$.
\begin{equation}
f=f_{\mathrm{org}}+n
\end{equation}

V na¹em diskrétním pojetí budeme uva¾ovat funkci $n$ jako náhodnou velièinu (NV), která mìla $h\cdot w$ realizací ($h$ \dots
vý¹ka, $w$ \dots ¹íøka) nebo jako $h\cdot w$ náhodných velièin. 

\subsubsection{Bílý ¹um}

Situaci si zjednodu¹íme pøedpokladem tzv. {\em Bílého ¹umu}, co¾ jsou nezávislé, stejnì rozdìlené (iid) NV $X$, takové, ¾e $EX=0$.
Analogie s bílým svìtlem plyne z toho, ¾e tento ¹um obsahuje v¹echny frekvence. 

Spoèítejme {\em power spectrum (PS)} na¹í
¹umové funkce. Power spektrum odpovídá amplitudì spektra po Fourierovì transformace funkce $n$ (tj. $PS=|N|^2$).
 
Pokud provedeme korelaci bílého ¹umu, dostáváme
\begin{eqnarray}
n\corr n&=&\sigma^2\cdot \delta\stackrel{CFT}{\rightarrow}\sigma^2\label{korel}\\
\noalign{\hbox{Ve frekvenèní oblasti je ale}\nonumber}\\
N\cdot N^\star&=&|N|^2
\end{eqnarray}

Vztah (\ref{korel}) plyne z vlastností ¹umu (tj. z nezávislosti NV). Vidíme, ¾e power spectrum je rovno rozptylu a je to tudí¾ 
konstantní velièina (co¾ je opìt pro bílý ¹um charakteristické). V praxi by mìla pøi korelaci vzniknout matice,
která je v¹ude nulová jen vprostøed je hodnota rozptylu.

\ods{Ostranìní ¹umu} 

Cílem je sní¾it rozptyl ¹umové funkce. Proto¾e lidskému oku nejvíce \uv{vadí} vysoké frekvence ¹umu, provádí
se tzv. {\em nízkofrekvenèní filtr}, který tyto frekvence potlaèuje. To s sebou nese i nepøíjemnou vlastnost a to, ¾e
na vysokých frekvencích jsou zaznamenány i informace o hranách, které se tímto zpùsobem rozmazávají.

\begin{enumerate}
\item Prùmìrování -- pou¾íváme napøíklad konvoluèní maticí $C$
\begin{eqnarray}
C&=&\frac{1}{9}\left(\begin{array}{ccc}1&1&1\\1&1&1\\1&1&1\end{array}\right)
\end{eqnarray}
nebo
\begin{eqnarray}
C&=&\frac{1}{16}\left(\begin{array}{ccc}1&2&1\\2&4&2\\1&2&1\end{array}\right)
\end{eqnarray}

\item Prùmìrování podél hran -- podél hran pou¾íváme jiný druh filtru (pokud  ov¹em hrany známe), 
v ostatních èástech obrazu pou¾íváme obyèejné prùmìrování.

\item Metoda rotujícího okna -- pou¾ívájí se dva typy konvoluèní matice pro v¹ech 8  smìrù (4+4) v daném bodì. 
Spoèítáme konvoluce a za výslednou hodnotu bereme tu, která vznikla v oknì, je¾ má minimální rozptyl od této 
hodnoty. Dìláme v podstatì \uv{prùmìr pøes maximální homogenitu}. Tato metoda se dost pou¾ívá a dává dobré výsledky.

\item Prahování -- výsledek mìníme pouze pokud konvoluce v bodì pøekroèila zadaný práh. 
\item Mediánový filtr -- v oknì provedeme seøazení dat a prostøední prvek (medián) dáváme do výsledku. 

Tato metoda
potlaèuje ¹um, ale \uv{okusuje} okraje a rohy. Proto je vhodnìj¹í volit za výbìrové okno tøeba køí¾. 

Nároènost algoritmu
pro okno ¹íøky $n$ by byla pøi klasickém tøídìní $O(n^4)$, pøi QUICKSORTu nebo HEAPSORTu $O(n^2\log^2 n)$, pøípadnì
$O(n\log n)$, kdy¾ vyu¾ijeme vkládání do utøídìné posloupnosti. Novìj¹í algoritmus FMF (fast median filter) pracuje pøi
slo¾itosti $O(n)$. Urychlení je provedeno díky konstrukci a aktualizaci histogramu, hledání mediánu je pak velmi rychlé.

\item Zobecnìný mediánový filtr -- v oknì provedeme seøazení dat a na setøídìnou posloupnost aplikujeme váhovou funkci $w$
 rovnu napø. 
\begin{eqnarray}
w=\frac{1}{4}(0,\dots,0,1,2,1,0,\dots,0)
\end{eqnarray}
\end{enumerate}

\vecobr{0.6}{rotwin}{Metoda rotujícího okna}

Témìø v¹echny pøedchozí filtry jde provádìt i ve frekvenèní oblasti. Pokud víme, ¾e má obraz jen jisté druhy
hran (napø. vodorovné), lze pou¾ít speciální filtr (napø. $\frac{1}{4}(1\ 1\ 1\ 1)$). Ve frekvenèní oblasti
má pak tento filtr takté¾ speciální tvar.

\subsubsection{©um typu sùl a pepø (salt \& pepper)}

Tento speciální druh ¹umu vzniká pøi poøizování obrázku na snímacích zaøízeních. Vìt¹ina bodù je správnì naètená, ale 
obèas nìkterý vypadne nebo se maximálnì zesvìtlí. Matematický model vypadá takto.

\begin{equation}
n=\left\{\begin{array}{cl}+\infty&\hbox{s pravdìp. $p$}\\
0&\hbox{jinak}\\-\infty&\hbox{s pravdìp. $p$}
\end{array}\right.
\end{equation}

Filtr, který tyto nesprávnì naètené body opravuje, je opìt v podobì konvoluèního filtru s maticí tvaru
\begin{eqnarray}
C&=&\frac{1}{8}\left(\begin{array}{ccc}1&1&1\\1&0&1\\1&1&1\end{array}\right)
\end{eqnarray}

Aplikuje se pouze na tmavé a svìtlé body obrazu (v ostatních to nemá smysl) a dává uspokojivé výsledky.

Pokud provádíme opakované snímání (napø. sledujeme experiment v laboratoøi), pou¾ívá se i triviální odstranìní ¹umu
pomocí prùmìrování více kopií, proto¾e na ka¾dé je jiná realizace ¹umu, který¾to v prùmìru vymizí. Pokud je mo¾nost
takového snímání, pak se jedná o ideální zpùsob, jak ¹um odstranit.

\subsubsection{Periodické po¹kození obrázku}

Pokud se na obraze vyskytuje jisté periodické po¹kození (napø. pohled pøes pletivo, møí¾e, fotka na vroubkovaném papíøe),
lze tyto \uv{funkce} z obrazu odstranit. Ve frekvenèní oblasti toti¾ obdr¾íme amplitudové spektrum s nápadnými
symetrickými píky mimo støed. Kdy¾ tyto odstraníme, vymizí z obrazu i po¹kození.


\subsubsection{Kvantifikace ¹umu}

Pro mìøení \uv{velikosti} ¹umu v obraze se zavádí tzv. {\em signal noise ratio (SNR)}, co¾ je funkce definovaná
jako
\begin{eqnarray}
SNR=\frac{|N|^2}{|F|^2}(u,v)
\end{eqnarray}

Tato funkce zachycuje tu vlastnost, ¾e ¹um nám vadí hlavnì pøi vysokých frekvencích.
Pokud provedeme velké zjednodu¹ení a budeme pøedpokládat, ¾e obrázek (tj. signál) není prostorovì korelovaný, dále budeme
pøedpokládat bílý ¹um, dostáváme vztah

\begin{eqnarray}
SNR=\frac{|N|^2}{|F|^2}(u,v)=\frac{\sigma_n^2}{\sigma_f^2}.
\end{eqnarray}

Pro rozumnou práci definujeme tzv. {\em odstup signálu od ¹umu}, který mìøíme v decibelech [dB] a definujeme jej jako

\begin{eqnarray}
snr=-10\log\frac{\sigma_n^2}{\sigma_f^2}
\end{eqnarray}

Èím vy¹¹í je hodnota, tím lep¹í (kvalitnìj¹í) máme signál.

\subsubsection{Aproximace}
Pohlédneme-li na za¹umìlý signál jako na pøibli¾nou funkci, mù¾eme se pokusit pou¾ít aproximaèních metod k rekonstrukci
pùvodního (neza¹umìného) signálu. Hledáme funkci $f$, která øe¹í rovnici

\vecobr{0.6}{aprox}{Odstraòování ¹umu z pohledu aproximace funkcí.}

\begin{eqnarray}
min[\lambda \sum\limits_{ij} \|f(x_{ij})-u_{ij}\|^2+\mathcal{J}(f)]\\
\noalign{\hbox{kde}\nonumber}\\
\mathcal{J}(f)=\int\!\!\!\!\int\left(\frac{\partial^2f}{\partial x^2}\right)^2+2\frac{\partial^2f}{\partial x\partial y}+
\left(\frac{\partial^2f}{\partial y^2}\right)^2
\end{eqnarray}

kde $u_{ij}$ jsou na¹e namìøená data, koeficient $\lambda$  udr¾uje  hladkost výsledku a $f$ je hledaná funkce.
Tu pøedpokládáme ve tvaru {\em kubické spline} køivky, tak¾e gradientními metodami jsme schopni nalézt její koeficienty.
Je¹tì obecnìj¹í je rovnice pracující s váhami $w_{ij}$

\begin{eqnarray}
min[\lambda \sum\limits_{ij}w_{ij}\|f(x_{ij})-u_{ij}\|^2+\mathcal{J}(f)],
\end{eqnarray}

pøièem¾ váhy se dávájí do míst pøedpokládaných hran.

\subsection{Detekce hran}
Nejedná se ji¾ o pøedzpracování, spí¹e u¾ se sna¾íme rozpoznat dal¹í neobrazové informace. {\em Hranou}  pro nás bude
výrazná zmìna intenzity obrazu. Rozli¹ujeme tedy

\begin{description}
\item[hrana (edge)] -- surová (obrazová) informace
\item[hranice (boundary)] -- silnìj¹í informace, popsána jinak ne¾ obrazovì
\end{description}

Experimenty ukazují, ¾e lidské oko se podle hran silnì orientuje, ztráta hranové informace vede k zmatení a chybám v 
interpretaci vjemu. Detekce hran se realizuje nìkolika zpùsoby. Jsou zalo¾eny na sledování 1. (resp. 2.) derivace
funkce intenzity.

\vecobr{0.8}{druhyhran}{Typy hran pro rozpoznávání v obraze}
\vecobr{0.8}{druhaderivace}{Funkce obsahující hranu a její derivace}
\vecobr{0.8}{maxlaplace}{Hledání {\em zero-crossing point} pomocí $\max|\Delta f|$.}

\begin{enumerate}
\item první derivace -- {\em Robertsùv detektor:}  Jedná se o konvoluèní filtr s maticí $C=(1\ -1)$ nebo $C=(1\ 0\ -1)$.
Objevuje se v¹ak velká citlivost na ¹um, najdou se hrany i na místech, kde nejsou. Jistým vylep¹ením konvoluce s maticí
\begin{eqnarray}
C=\left(\begin{array}{ccc}1&0&-1\\1&0&-1\\1&0&-1\end{array}\right)
\end{eqnarray}

Pozn. Uva¾ovali jsem pouze svislé hrany, pro vodorovné hrany jsou matice symetrické.

\item první derivace -- {\em Sobelùv detektor:} Pro vodorovné hrany by konvoluèní matice vypadala takto

\begin{eqnarray}
C=\left(\begin{array}{ccc}-1&-2&-1\\0&0&0\\1&2&1\end{array}\right)
\end{eqnarray}

Pro zbylých 7 smìrù jsou matice obdobné. V¹esmìrovou detekci pak realizujeme postupnì a v¹ech 8 hranových obrazù spojíme 
dohromady za pou¾ití maximového pravidla. Pokud nejprve obrázek vyhladíme, a pak na nìj aplikujeme hranový detektor,
dostaneme hranový obraz, který by vznikl jako aplikace Robertsova detektoru na vìt¹í okolí, tak¾e ¾ádný lep¹í výsledek
se nedostaví.

\begin{eqnarray}
C_1&=&\left(\begin{array}{ccc}1&1&1\\1&1&1\\1&1&1\end{array}\right)\\
C_2&=&\left(\begin{array}{ccc}-1&-2&-1\\0&0&0\\1&2&1\end{array}\right)\\
C_3&=&C_1\circ C_2=\left(\begin{array}{ccc}-&-&-\\0&0&0\\+&+&+\end{array}\right)\\
(f\conv C_1)\conv C_2&=&f\conv C_3
\end{eqnarray}


\item druhá derivace -- hledáme body, kde má druhá derivace prùchod nulou. Neøe¹íme tedy rovnici $\Delta f=0$, ale hledáme,
zda se v $\Delta f$ objevují velké pøechody mezi kladnou a zápornou hodnotou (tzv. {\em zero-crossing points}). V tìch 
místech pak zaznamenáme hranu. Tento zpùsob je velmi náchylný na ¹um (dokonce víc ne¾ Robertsùv detektor). Marr a Hildreth
navrhli modifikaci, pøi které se sleduje funkce

\begin{eqnarray}
\Delta (G\conv f)=(\Delta G)\conv f
\end{eqnarray}

kde funkce $G$ je kruhovì symetrická Gaussova funkce. Takto provedená modifikace dává dobré výsledky. Matice $\Delta G$ 
se pøedpoèítává a bývá ¹iroká $5\times5$ a¾ $15\times15$ pixelù. Parametrizací Gaussovy funkce lze docílit výborných 
výsledkù. ©ir¹í funkce detekuje podstatné hrany a je ménì náchylná na ¹um, u¾¹í se chová jako pøedchozí detektory.
Detektor má tendenci vytváøet uzavøené hrany (køivky). Tento fakt plyne z teorie Laplaceových operátorù a øe¹ení
Laplaceovy rovnice $\Delta f=0$

\begin{eqnarray}
\Delta =\left(\begin{array}{ccc}0&1&0\\1&-4&1\\0&1&0\end{array}\right)
\end{eqnarray}

Pro lokalizaci hrany se èasto pou¾ívá místo slo¾itìj¹ího hledání \uv{prùchodu nulou} jednoduché nalezení $\max|\Delta f|$, 
jak plyne z obrázku \ref{maxlaplace}.
\item první derivace -- {\em Prewittùv detektor.}
Jako konvoluèní jádro pro detekci hran ve svislém smìru  se pou¾ije matice $3\times3$
\begin{eqnarray}
h =\left(\begin{array}{ccc}-1&1&1\\-1&-2&1\\-1&1&1\end{array}\right)
\end{eqnarray}

\item první derivace -- {\em Cannyho detektor.} Pou¾ívá se velmi èasto. Byl vytvoøen s po¾adavky:
\begin{itemize} 
\item jedna hrana -- jedna odezva
\item pøesná lokalizace hran
\item nic nepøehlédnout
\item nevytváøet zbyteèné hrany
\end{itemize}

Postup:

\begin{enumerate} 
\item Obraz se vyhladí pomocí konvoluce s Gaussovým jádrem, za úèelem odstranìní ¹umu
\item Provede se výpoèet parciálních derivací, staèí i jednoduchý detektor, napø. Roberts Cross function
$$\left|\begin{array}{cc}1&0\\0&-1\end{array}\right|$$
\item Provede se \uv{non-maximum suppression} -- tj. na základì gradientu spoèítaného z parciálních derivací odstraníme
z obrázku body, které nejsou lokálními maximy ve smìru kolmém na hranu
\item Provede se prahování celého obrázku, konkrétnì prahování s hysterezí
\end{enumerate}

\end{enumerate}



Cannyho detektor je tvoøen sadou odvozených filtrù, které závisí na parametrech.
\vecobr{0.4}{canny}{Ukázka sady filtrù {\em Cannyho detektoru}}
\vecobr{0.6}{gauss}{Gaussova funkce a její druhá derivace}
\ods{Zvýraznìní hran} 

Díky Laplaceovì operátoru $\Delta$ jsme schopni v obrázku zvýraznit hrany. 
Staèí provést opìt konvoluci s maticí $C$.

\begin{eqnarray}
C&=&\left(\begin{array}{ccc}0&-1&0\\-1&5&-1\\0&-1&0\end{array}\right)
\end{eqnarray}

Vlastnì jsme od funkce $f$ odeèetli $\Delta f$, jak ukazuje obrázek \refobr{zvyrazneni}.

\vecobr{0.6}{zvyrazneni}{Zvýraznìní hran pomocí operátoru $\Delta f$.}

\subsubsection{Detekce rohù}
Pro detekci rohù se nehodí klasické hranové filtry, proto¾e charakter rohù je svým zpùsobem
specifický rohové útvary nedávají patøièné odezvy na konvoluèní jádro.

\vecobr{0.6}{typyrohu}{Typy rohù}
\vecobr{0.6}{roh}{Odezva hranového detektoru na roh.}

\begin{itemize}
\item[a)]
\begin{enumerate}
\item provedeme segmentaci obrazu
\item procházíme hranice a detekujeme zlomová místa
\end{enumerate}
Tato metoda funguje dobøe pro binární obrázky, pro klasické selhává.
\item[b)] Corner response function (Baudetùv detektor) -- 
máme speciální konvoluèní masku a procházíme obraz $\rightarrow$ 
dostáváme odezvu pøi výskytu rohu. Sleduje se velièina 

\begin{equation}
C_B=\frac{f_{xx}f_{yy}-f_{xy}^2}{(1+f_x^2+f_y^2)^2}
\end{equation}

\ods{Kitchen \& Rosenfeld} -- vyhodnocuje se zmìna smìru gradientu podél hran, tato zmìna se násobí 
velikostí lokálního gradientu. Funkce popisující smìr gradientu je

\begin{equation}
\phi(x,y)=\tan^{-1}\left(\frac{f_y}{f_x}\right)
\end{equation}

Pøi procházení po hranì se smìr gradientu v pøípadì výskytu rohu zákonitì musí zmìnit. Konstatní smìr naopak
ukazuje na pøímou hranu. Zmìnu smìru zji¹»ujeme pomocí smìrových derivací $\phi$. Smìr hrany je kolmý na gradient,
neboli je to smìr $(-f_y,f_x)$. Funkce odezvy pak vypadá

\begin{eqnarray}
C_{KR}&=&\frac{(\phi_x,\phi_y)(-f_y,f_x)}{\left|(-f_y,f_x)\right|}\left|(f_x,f_y)\right|=\nonumber\\
&=&(\phi_x,\phi_y)(-f_y,f_x)=\frac{f^2_xf_{yy}-2f_xf_yf_{xy}+f_y^2f_{xx}}{f_x^2+f_y^2}
\end{eqnarray}

Detektor je dost citlivý na ¹um a není invariantní na otáèení.

\vecobr{0.6}{kitchen}{Detekce rohù metodou Kitchen \& Rosenfelda.}

\ods{Harrisùv detektor}
\begin{equation}
K=\frac{\overline{f^2_x}\,\overline{f^2_y}-(\overline{f_x}\,\overline{f_y})^2}{\overline{f^2_x}+\overline{f^2_y}}
\end{equation}
Pruh zde znaèí støední hodnotu pøes okolí. Výsledkem je sní¾ená citlivost na ¹um.

\end{itemize}


\subsection{Restaurace obrazu}
Nyní se zabývejme modelováním jiné ne¾ ¹umové degradace vzorového obrazu. Zajímat nás bude hlavnì konvoluèní degradace.
Nech» $g$ je ná¹ obrázek, $f$ bude ideální, nezkreslený obraz (originál). Symbol $\mathcal{O}$ bude znaèit 
{\em operátor degradace} a $n$ aditivní ¹um. Obecnì pøípad modelujeme vztahem $g=\mathcal{O} (f)$. Pøedpokládejme
speciální volbu operátoru $\mathcal{O}$ ve tvaru

\begin{eqnarray}
\mathcal{O}&=&T_G\circ T_I\\
\noalign{\hbox{kde $T_G$ je geometrická degradace}\nonumber}
\noalign{\hbox{a $T_I$ je radiometrická degradace}\nonumber}
\noalign{\hbox{výsledný model pak bude tedy}\nonumber}\\
g&=&T_G\circ T_I (f) +n
\end{eqnarray}

Pokud nepøedpokládáme geometrické zkreslení a uvá¾íme, ¾e ve vìt¹inì bì¾nì dostupných zobrazovacích systémù lze $T_I$ 
modelovat pomocí konvoluce, mù¾eme vztah pøepsat na

\begin{eqnarray}
g&=&f\conv h +n \label{eqv1}
\end{eqnarray}

Funkce $h$ se zde oznaèuje jako  {\em Impulsní odezva} a jedná se o tzv. {\em point spread function} (polohovì invariantní)
funkci. Polohová invariance znaèí skuteènost, ¾e výsledek vztahu ovlivòující dva pixely není závislý na jejich poloze, 
nýbr¾, jen a pouze na jejich vzájemné vzdálenosti.

Pøedpokládejme nyní $n=0$ v rovnici (\ref{eqv1}). Pak s touto mù¾eme provést Fourierovu transformaci. Dostáváme

\begin{eqnarray}
G&=&F\cdot H\label{eqv2}
\end{eqnarray}
Funkce $H$ se oznaèuje jako {\em pøenosová funkce}. Pokud známe $h$ lze navrhnout {\em inverzní filtr} 
ve frekvenèní oblasti.

\begin{eqnarray}
F&=&G/H\label{eqv3}\\
\noalign{\hbox{Po inverzní Fourierovì transformaci}\nonumber}\\
\hat{f}&=&\mathcal{FT}^{-1}(F)
\end{eqnarray}
obr¾íme obraz podobný originálu. Dìlení ve vztahu (\ref{eqv3}) provádíme po slo¾kách. Nulové body v $H$ mù¾ou 
následnì vadit pøi inverzní Fourierovì transformaci, proto provádíme bilineární interpolaci funkce $F$ 
z nejbli¾¹ího okolí v místech, kde bylo $H$ nulové.


\vecobr{0.5}{sumnh}{Hodnoty funkcí $H(x)$, $N(x)$ a jejich podílu}

Pro model se ¹umem bude

\begin{eqnarray}
g&=&f \conv h+n\label{eqv4}\\
G&=&F\cdot H+N\label{eqv5}\\
F&=&\frac{G-N}{H}=\frac{G}{H}-\frac{N}{H}\label{eqv6}
\end{eqnarray}

Èlen $\frac{N}{H}$, který jsme v pøedchozím zanedbávali mù¾e mít velmi zásadní vliv na výsledek a to i pro malá $n$ jako
ukazuje graf na obrázku \ref{sumnh}. Tato metoda je proto v reálných obrázcích témìø nepou¾itelná.

Dal¹í mo¾ností je napøíklad pøedpokládat $H$ ve tvaru 


\begin{eqnarray}
H&=&\left(\begin{array}{ccc}a&b&a\\b&c&b\\a&b&a\end{array}\right)\\
\noalign{\hbox{a øe¹it lineární soustavu rovnic}\nonumber}\\
G&=&F\cdot H
\end{eqnarray}

\subsubsection{Wienerùv filtr}
Po¾adavkem na Wienerùv filtr $W$ bylo 

\begin{eqnarray}
\hat{F}&=&G\cdot W\\
\noalign{\hbox{kde $\hat{F}$ se definuje}\nonumber}\\
\hat{F}&=&\|f-\hat{f}\|^2\\
\noalign{\hbox{a hledáme}\nonumber}\\
W&=&\mathrm{argmin}E(\|f-\hat{f}\|^2)\label{minimalizace}
\end{eqnarray}

Ve vztahu (\ref{minimalizace}) minimalizujeme pøes v¹echny realizace ¹umu. Matice $W$ není pøesnì daná, je to funkce obrazu!
Po netriviálním odvození dostaneme výsledek

\begin{eqnarray}
W&=&\frac{1}{H}\cdot\frac{|H|^2}{|H|^2+\phi(u,v)}
\end{eqnarray}
Funkce $\phi(u,v)$ znaèí SNR (signal noise ratio). Pøipomeòme její definici ve frekvenèní oblasti.

\begin{eqnarray}
\phi&=&\frac{|N|^2}{|F|^2}
\end{eqnarray}

Hodnoty $|N|^2$ a $|F|^2$ se nazývají výkonová spektra (power spectrum). Je vidìt, ¾e pøi nepøítomnosti ¹umu 
pøechází Wienerùv filtr na pøedchozí jednoduchý filtr. Pokud neznáme (co¾ je vìt¹inou) $|F|$ a $|N|$, mù¾eme zkusit
uva¾ovat bílý ¹um a nekorelovanost pùvodního obrazu.

\begin{eqnarray}
 f\corr f&=&\delta(x)\sigma_f^2=\left\{\begin{array}{cc}\sigma_f^2\cdot\delta(0)&\hbox{pokud le¾í pøesnì na sobì}\\0&\hbox{jinde}\end{array}\right.
\end{eqnarray}
Budeme mít

\begin{eqnarray}
\phi&=&\frac{\sigma_n^2}{\sigma_f^2}
\end{eqnarray}

Postupujeme tedy tak, ¾e s hodnotou $\phi$ zaèínáme na nízko ($\sim 10^{-3}$) a postupnì ji zvy¹ujeme a sledujeme, co se 
dìje s obrazem. 

Stále neznámé $h$, které navíc mù¾e být tvaru $h=h_1\conv h_2\conv h_3 \conv \dots$, nelze obecnì zjistit. Mù¾eme jej
pouze pøedpokládat ve speciálních tvarech, abychom znali tvar impulsní odezvy. Reálnì máme vìt¹inou jeden z tìchto druhù degradace.

\begin{itemize}
\item[a)] ¹patné zaostøení
\item[b)] turbulence (napø. snímek pøes tlustou vrstvu atmosféry)
\item[c)] rozmazání pohybem
\end{itemize}

\ods{ad c)} Je-li pohyb lineární (tj. po pøímce) má impulsní odezva tvar obdélníka. 
\begin{itemize}
\item délka je úmìrná délce expozice (pøi konstantní rychlosti pohybu)
\item ¹íøka bude obrácená hodnota délky, abychom zachovali $\int h=1$ a nevná¹eli tak do obrázku
jas. 
\item ve smìru kolmém na smìr pohybu se tento obdélníèek chová jako $\delta$-funkce, tedy nic nemìní. 
\end{itemize}

Po Fourierovì transformaci obdr¾íme ve frekvenèní oblasti známou funkci $\mathrm{sinc}$, natoèenou do smìru pohybu. 
Slangovì se tato funkce oznaèuje jako {\em vlnitý plech}\footnote{Název zavedl J. Flusser :-)}. 

\begin{itemize}
\item nulové hodnoty funkce $H$ budou le¾et na pøímkách kolmých na smìr pohybu. Èím blí¾e budou k sobì, tím je rozmazání 
vìt¹í. 
\item stejné nulové body budou zachovány i ve funkci $G$. Mù¾eme tak najít smìr a délku pohybu (bìhem
expozice). Získáváme odhad pro $H$ do Wienerova filtru. 
\end{itemize}

Podobnì lze odhadovat impulsní odezvy na jiné druhy pohybu (napø. dítì na houpaèce). Nìkteré druhy pohybù lze pøevést na
známé u¾itím souøadnicové transformace. Tøeba rotaèní pohyb gramofonové desky pøi snímání shora, pøevedeme na pohyb 
lineární s konstatní (úhlovou) rychlostí pomocí radiálních souøadnic.

Pøi nekonstatních rychlostech je situace obtí¾ná, proto¾e se vytrácí polohová invariance.


\ods{ad a)} Ideálním rozostøením svìtelného bodu je kruh. 
\begin{itemize}
\item ve skuteènosti klesá jeho intenzita ke krajùm
\item impulsní odezva je tvaru válce -- pøenosová funkce má nulové body na soustøedných kru¾nicích
  \begin{eqnarray}
    H\sim \frac{J_1}{r}\label{bessel}\qquad\begin{array}{ccl}\hbox{$J_1$}&\hbox{\dots}&\hbox{Besselova funkce 1. druhu}\\
    \hbox{$r$}&\hbox{\dots}&\hbox{radiální souøadnice}
    \end{array}
  \end{eqnarray}
Díky výrazu $\frac{1}{r}$ ve vztahu (\ref{bessel}) jsou Besselovy kmity tlumené.

\item stejné nulové body budou zachovány i ve funkci $G$. Postup je obdobný jako v pøípadì lineárního posunutí.
Zmìøíme vzdálenost kru¾nic, odhadneme impulsní odezvu a aplikujeme Wienerùv filtr. 
\end{itemize}

\ods{ad b)} Vzniká napø. pøi del¹í expozièní dobì, ne¾ je perioda Brownova pohybu èástic v atmosféøe. 
\begin{itemize}
\item impulní odezva (a pøenosová funkce) jsou Gaussovy funkce. Nemají tedy nulové body a nelze proto pou¾ít metodu
z pøedchozích pøípadù
\item k odhadu se pou¾ívájí body, které nemìní polohu, napø. hvìzdy ve snímcích oblohy (astronomie)
\end{itemize}

\subsubsection{Problém slepé dekonvoluce}
V obecném pøípadì pro neznámé $h$ nemá úloha jednoznaèné øe¹ení. Zavádíme proto dodateèné omezující podmínky.

\begin{itemize}
\item nezápornost originálního signálu (snímku)
\item omezenost supportu $h$
\item minimalizace jistého potenciálového funkcionálu výsledného obrazu
\end{itemize}

Jiným problémem je tzv. {\em vícekanálová slepá dekonvoluce}, kdy máme k dispozici nìkolik stejných snímkù s jinými
impulsními odezvami. Tedy systém
\begin{eqnarray}
g_1&=&f\conv h_1+n_1\\
&\vdots&\nonumber\\
g_l&=&f\conv h_l+n_l
\end{eqnarray}

Tato úloha je nepomìrnì sna¾¹í, proto¾e máme daleko více informací a z ka¾dého $g_i$ jsme schopni zrekonstruhovat 
jiné èásti obrázku. Výsledek tedy mù¾eme \uv{poslepovat} z nìkolika takových èástí. Také jsme schopni daleko lépe 
odstraòovat pøípadné ¹umy, podobnì jako pøi prùmìrování více kopií.

\subsection{Geometrické zkreslení}
Model geometrického zkreslení obrazu lze zapsat jako

\begin{eqnarray}
g=T_G(f)
\end{eqnarray}

Máme-li snímek té¾e scény z rùzných pohledù (tj. s jiným geometrickým zkreslením) a potøebujeme-li zjistit odpovídající
pixely (tj. aby stejné pixely mìly stejné souøadnice), mluvíme o {\em Registraci obrazu (image registration)}. Vyu¾ití
spoèívá napø. v detekci èasových zmìn. Nepøesná registrace vede na chybnou detekci resp. zji¹tìní zmìn tam kde nejsou.

Registrace se provádí pomocí øídících bodù (control points). Pokud jsou správnì nalezeny odpovídající øídící body v obou
obrazech, je mo¾né sestavit geometrické transformace a snímky zregistrovat.

\ods{Po¾adavky na øídící body}

\begin{itemize}
\item vìt¹í poèet
\item detekovatelné v obou obrazech
\item rozmístìny po celém snímku
\end{itemize}

Po urèení øídících bodù je tøeba provést vzájemnou korespondenci. Tato operace se oznaèuje jako ({\em matching}). 
K tomuto úèelu musíme mít dostateènì robusní, spolehlivou metodu, nebo» nìkteré body mohou chybìt, mohlo dojít
k nepøesnostem atp. 

Jako významné øídící body se volí {\em rohy, prùseèíky} -- tyto jsou v¹ak citlivé na ¹um, nebo {\em tì¾i¹tì uzavøených 
oblastí} -- na ¹um více stabilní.

Hledání odpovídajících bodù se provádí
\begin{itemize} 
\item topologicky (pøedpokládaný výskyt)
\item prohledává se okolí bodu s ohledem na intenzity (barvy) okolních pixelù
\end{itemize}

\vecobr{0.7}{contrpoint}{Postup pøi registraci dvou snímkù}
\ods{Mapovací funkce (Mapping function design)}

Pøi vlastním mapování hledáme

\begin{eqnarray}
u&=&f(x,y)\\
v&=&g(x,y)\\
\noalign{\hbox{s podmínkou P1:}\nonumber}
u_i&=&f(x_i,y_i)\\
v_i&=&g(x_i,y_i)\qquad\forall i\in m,\ \hbox{kde $m$ je poèet øídících bodù}
\end{eqnarray}

Funkce $f,g$ pøedpokládáme spojité a dost hladké, navíc parametrizovatelné (napø. afinní transformace). 
Parametry funkcí hledáme øe¹ením následujících úloh
\begin{itemize}
\item {\em interpolaèní úloha} -- s podmínkou P1
\item {\em extrapolaèní úloha} -- bez podmínky P1
\end{itemize}

Po nalezení funkcí ji¾ nic nebrání tomu, abychom obrazy namapovali bod po bodu.

\subsection{Výbìr øídících bodù (control point selection)}
Metody dìlíme na
\begin{itemize}
\item {\em Korelaèní (signálnì závislé)} -- korelaci provádíme se skuteènými obrazovými hodnotami. Jeden obraz (okno)
posouváme po druhém a poèítáme korelaci. Pokud existuje vìt¹í èi men¹í shoda obrázku, bude na daném bodì ve výsledné matici
vysoká hodnota. Pøi konstatní korelaèní matici pak tento postup odpovídá poèítání vztahu

\begin{eqnarray}
\frac{E[(X-EX)(Y-EY)]}{varX varY}
\end{eqnarray}

co¾ odpovídá vztahu

\begin{eqnarray}
C(X,Y)=\frac{\sum\limits_{i=0}^{N-1}
\sum\limits_{j=0}^{N-1}((X_{ij}-\bar{X})\cdot(Y_{ij}-\bar{Y}))}
{\sqrt{\sum\limits_{i=0}^{N-1}\sum\limits_{j=0}^{N-1}(X_{ij}-\bar{X})^2\cdot(Y_{ij}-\bar{Y})^2}}
\end{eqnarray}

Metoda funguje dobøe pro obrazy se stejnou intenzitou nebo pokud do¹lo ke globálním zmìnám kontrastu a jasu. Ostatní zmìny
dost vadí. V základním provedení by metoda fungovala jen pro posun. 

Provádí se modifikace, kdy je korelaèní matice trojrozmìrná. Èasová nároènost je ale pøíli¹ velká, proto se metoda pou¾ívá
pro malé rotace. Metoda dává dobré výsledky po hranové detekci v obou obrazech.

Urychlení výpoèetní slo¾itosti plyne z {\em Korelaèního teorému}
\begin{eqnarray}
f\corr g \stackrel{CFT}{\rightarrow}F\cdot G^\star
\end{eqnarray}

kde symbol $(\cdot)^\star$ znaèí komplexnì sdru¾enou matici

\item {\em Fázová korelace} -- Vyu¾ívá Fourier-shift-theoremu. Máme dány funkce $f(x)$ a $g(x)=f(x-a)$. Po Fourierovì
transformaci bude

\begin{eqnarray}
f(x)&\stackrel{CFT}{\rightarrow}&F(u)\\
g(x)&\stackrel{CFT}{\rightarrow}&e^{iau}F(u)\\
\noalign{\hbox{a proto¾e se sna¾íme získat vektor posunutí $a$, spoèteme}\nonumber}\\
\frac{F\cdot G^\star}{|F||G|}&=&\frac{F^2e^{iau}}{|F|^2}\stackrel{CFT^{-1}}{\longrightarrow}\delta(x-a)
\end{eqnarray}

Tím vznikne dobøe lokalizovatelný pík. Metoda funguje dobøe, odpovídá vlastnì detekci hran a korelaci v obrazové oblasti.

\item {\em nepodobnost (SSDA)} -- oznaèuje se také jako \uv{klasická korelace}. Hledá se bod,
 kde vztah $\sum|f_{ij}-g_{ij}|$
nabývá minima. Hledání minima zøejmì urychluje metodu, proto¾e pøi napoèítávání sumy, máme samé kladné hodnoty a 
jakmile jednou èásteèný souèet pøevý¹í ji¾ vypoètené minimum, lze pøímo pøejít k dal¹ímu bodu.
\end{itemize}

Pro snadnou hardwarovou implementaci korelace jsou tyto metody dosti pou¾ívané.


\begin{itemize}
\item {\em Point-based method} -- pro zjistìní korespondence øídících bodù (matching) se vytváøí úplný graf a hledají se 
4 parametry pro geometrickou transformaci (posun 2, rotace 1, mìøítko 1). Porovnáváme po dvojici úseèek a zji¹»ujeme,
jak ostatní body padají do okolí øídících bodù.

Dal¹í mo¾nost je provést matching a zaznamenávat do parametrického prostoru provedenou transformaci. Pak hledat shluk
v tomto prostoru a vybrat tak nejlep¹í parametr.

Pro urychlení se nekonstruhuje úplný graf, ale tøeba konvexní obálka nebo kostra grafu. Tím ov¹em zavádíme do algoritmu vý¹¹í 
náchylnost k chybám a nestabilitì.

\vecobr{0.7}{match}{Zji¹tìní vzájemné korespondence øídících bodù (matching)}

\item {\em Region-based method} -- pro okolí øídících bodù hledáme spoleèné charakteristiky, které by mìli být
 \begin{itemize}
  \item {\em invariantní vzhledem k transformaci} -- rotace, mìøítko, \dots
  \item {\em dostateènì diskriminabilní} 
 \end{itemize}
\end{itemize}

\vecobr{0.7}{regbased}{Urèování okolí bodù a jejich charakteristik (Region-based method)}
\subsection{Mapovací funkce}
Pøedpokládejme transformaèní model

\begin{eqnarray}
u&=&a_0+a_1x+a_2y\nonumber\\
v&=&b_0+b_1x+b_2y\label{afinita}
\end{eqnarray}

Tento model ({\em Afinita}) je jeden z nejjednodu¹¹ích, pøesto velmi pou¾ívaný. Zachovává rovnobì¾nost pøímek. 
Dal¹ím modelem je {\em Perspektivní projekce}.

\begin{eqnarray}
u&=&\frac{a_0+a_1x+a_2y}{1+c_1x+c_2y}\nonumber\\
v&=&\frac{b_0+b_1x+b_2y}{1+c_1x+c_2y}\label{perspekt}
\end{eqnarray}

Perspektivní projekce je obecnìj¹í transformace. Má v¹ak tu vlastnost, ¾e pøi pozorování z vìt¹ích vzdáleností v afinitu
pøechází, nebo» $c_1$ a $c_2$ ve vztazích (\ref{perspekt}) budou malé.

\vecobr{0.7}{trans}{Základní mapovací funkce}

Jeden z nejobecnìj¹ích modelù má tvar

\begin{eqnarray}
u&=&a_0+a_1x+a_2y+a_3xy\ [{}+a_4x^2+a_5y^2\ ]\nonumber\\
v&=&b_0+b_1x+b_2y+b_3xy\ [{}+b_4x^2+b_5y^2\ ]
\end{eqnarray}
Tento model je silnì nelineární, nezachovává pøímky ani rovnobì¾nost. Pou¾ívá se èasto.

\subsubsection{K metodì nejmen¹ích ètvercù}
Pøedpkládejme parametrizovatelnou funkci $f(x,a_1,\dots,a_l)$ a k ní pøedem zadanou mno¾inu bodù $U=\{[x_1,y_1],\dots,[x_K,y_K]\}$.
Definujme funkci $d$ 

\vecobr{0.7}{minkv}{K metodì nejmen¹ích ètvercù}
\begin{eqnarray}
d&=&\sum\limits_{i=1}^K (f(x_i)-y_i)^2\label{minkvad}
\end{eqnarray}
Proto¾e hledáme minumum funkce $d$, mluvíme o {\em metodì nejmen¹ích ètvercù}. Polo¾íme-li 
parciální derivace podle parametrù do rovnosti s
nulou, dostáváme

\begin{eqnarray}
\frac{\partial d}{\partial a_i}&=&0\qquad\forall i\in \hat{K}
\end{eqnarray}
Co¾ je obecnì nelineární systém rovnic, po jeho¾ vyøe¹ení a ovìøení, ¾e se jedná o minimum,  získáme námi hledané koeficienty. Vztah (\ref{minkvad}) lze 
obecnì psát ve tvaru $\|U-f\|_\mathcal{N}$, kdy norma $\|\cdot\|_\mathcal{N}$ definuje nìjakým zpùsobem vzdálenost bodù
od hledané funkce (køivky).

\subsubsection{Vlastní mapování}
Pøi vlastním mapování se pou¾ívájí pøímé a nepøímé transformace.

\begin{itemize}
\item {\em pøímá} -- procházíme v¹echny body ze zdrojového obrazu, transformujeme je a zapisujeme do výsledku. 
Vznikají situace, kdy se více bodù namapuje na stejné místo (pøepisování) a výsledný obraz mù¾e obsahovat nìkteré
prázné pixely (díry). Pro takové body je tøeba provést interpolaci z okolních pixelù.

\item {\em nepøímá} -- procházíme v¹echny body výsledného obrazu a pomocí zpìtné transformace urèíme, který zdrojový bod
se na nì obrazí.
\end{itemize}

Nelineární transformace se èasto provádí po trojúhelnících, na kterých se transformaèní funkce linearizuje 
(obdoba metody koneèných prvkù).
Pokud se pou¾ijí lineární polynomy, má tento postup za následek nepøirozené zalamování hran na pøechodových stranách
trojúhelníkové sítì. Obecnìji se proto definují {\em Radiální bázové funkce}, které tyto vlastnosti nemají.

\begin{eqnarray}
u=\sum a_i\phi_i(r_i)
\end{eqnarray}

\pngfig{0.6}{lena}{Originální obraz}
\pngfig{0.6}{origspec}{Frekvenèní spektrum originálu}
\pngfig{0.6}{lenaposkoz}{Obraz s periodickým po¹kozením}
\pngfig{0.6}{poskspec}{Frekvenèní spektrum po¹kozeného obrazu}
\pngfig{0.6}{restorespec}{Upravené spektrum po¹kozeného obrazu}
\pngfig{0.6}{lenares}{Výsledný restaurovaný obraz}

